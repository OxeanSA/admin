<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asher-Link | ISP Management Core</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --sidebar-width: 260px;
            --brand-primary: #0061ff;
            --brand-secondary: #60a5fa;
            --surface: #ffffff;
            --bg-canvas: #f4f7fa;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --sidebar-bg: #0f172a;
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body { 
            background-color: var(--bg-canvas);
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: var(--text-main);
            overflow-x: hidden;
        }

        /* Sidebar Architecture */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: var(--sidebar-bg);
            color: white;
            padding: 1.5rem;
            z-index: 1000;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            padding: 2rem;
            transition: all 0.3s ease;
        }

        /* Enterprise Components */
        .stat-card {
            background: var(--surface);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .btn-isp {
            background: var(--brand-primary);
            color: white;
            border-radius: 10px;
            padding: 0.6rem 1.5rem;
            font-weight: 600;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-isp:hover {
            background: #0056e0;
            box-shadow: 0 4px 12px rgba(0, 97, 255, 0.3);
        }

        .nav-link-custom {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }

        .nav-link-custom:hover, .nav-link-custom.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Dashboard Specifics */
        .badge-isp {
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-success { background: #dcfce7; color: #15803d; }
        .badge-danger { background: #fee2e2; color: #b91c1c; }

        .form-isp {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 0.75rem;
            background: #f8fafc;
        }

        #login-overlay {
            position: fixed;
            inset: 0;
            background: #0f172a;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: white;
            width: 400px;
            padding: 3rem;
            border-radius: 24px;
            text-align: center;
        }

        .header-action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .isp-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        .isp-table tr {
            background: white;
            border-radius: 12px;
        }

        .isp-table td {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
        }

        .isp-table td:first-child { border-left: 1px solid #e2e8f0; border-radius: 12px 0 0 12px; }
        .isp-table td:last-child { border-right: 1px solid #e2e8f0; border-radius: 0 12px 12px 0; }

    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-card shadow-2xl">
        <img src="https://api.oxeansa.co.za/static/logo.png" alt="AsherLink" style="height: 50px; margin-bottom: 20px;">
        <h4 class="fw-bold mb-1">Infrastructure Login</h4>
        <p class="text-muted small mb-4">Provide management credentials to continue</p>
        <input type="password" id="admin_password" class="form-control form-isp mb-3 text-center" placeholder="Access Token">
        <button onclick="attemptLogin()" class="btn-isp w-100">Authorize Access</button>
    </div>
</div>

<div id="dashboard-content" style="display:none;">
    <div class="sidebar shadow">
        <div class="mb-5 d-flex align-items-center">
            <i class="bi bi-cpu-fill fs-3 me-2 text-primary"></i>
            <span class="fs-5 fw-bold">ASHER-CORE</span>
        </div>
        
        <nav>
            <a href="#" class="nav-link-custom active"><i class="bi bi-grid-1x2-fill me-3"></i> Dashboard</a>
            <a href="#ads" class="nav-link-custom"><i class="bi bi-megaphone me-3"></i> Ad Inventory</a>
            <a href="#packages" class="nav-link-custom"><i class="bi bi-wifi me-3"></i> Wi-Fi Bundles</a>
            <a href="#tokens" class="nav-link-custom"><i class="bi bi-ticket-perforated me-3"></i> Local Tokens</a>
            <div class="mt-5 pt-5">
                <a href="javascript:logout()" class="nav-link-custom text-danger"><i class="bi bi-power me-3"></i> System Logout</a>
            </div>
        </nav>
    </div>

    <div class="main-content">
        <div class="header-action-bar">
            <div>
                <h3 class="fw-bold mb-0">Network Operations</h3>
                <p class="text-muted small">Real-time status of Asher-Link infrastructure</p>
            </div>
            <button onclick="loadDashboard()" class="btn btn-outline-secondary btn-sm rounded-pill px-3">
                <i class="bi bi-arrow-clockwise me-1"></i> Refresh Node
            </button>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="stat-card">
                    <span class="text-muted small fw-bold text-uppercase">Total Ad Revenue</span>
                    <h2 class="fw-800 mt-2 mb-0" id="total-revenue">R 0.00</h2>
                    <div class="text-success small mt-2"><i class="bi bi-graph-up"></i> Live Performance</div>
                </div>
            </div>
            <div class="col-md-9">
                <div class="stat-card">
                    <canvas id="performanceChart" height="60"></canvas>
                </div>
            </div>
        </div>

        <div class="row mb-5" id="ads">
            <div class="col-12">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold m-0">Campaign Orchestration</h5>
                        <button class="btn btn-isp btn-sm" data-bs-toggle="collapse" data-bs-target="#adFormCollapse">
                            <i class="bi bi-plus-lg me-1"></i> New Campaign
                        </button>
                    </div>
                    
                    <div class="collapse mb-4" id="adFormCollapse">
                        <form id="adForm" class="p-4 bg-light rounded-4">
                            <div class="row g-3">
                                <div class="col-md-4"><input type="text" id="new_ad_id" class="form-control form-isp" placeholder="Client Name"></div>
                                <div class="col-md-4"><input type="url" id="new_target_url" class="form-control form-isp" placeholder="Destination URL"></div>
                                <div class="col-md-4"><input type="file" id="new_file" class="form-control form-isp"></div>
                                <div class="col-md-3"><input type="number" id="new_total_limit" class="form-control form-isp" placeholder="Total Limit"></div>
                                <div class="col-md-3"><input type="number" id="new_daily_limit" class="form-control form-isp" placeholder="Daily Limit"></div>
                                <div class="col-md-3"><input type="number" id="new_cpm" class="form-control form-isp" value="50.00"></div>
                                <div class="col-md-3"><button type="submit" class="btn btn-isp w-100">Deploy Asset</button></div>
                            </div>
                        </form>
                    </div>

                    <div id="ad-list" class="row g-4">
                        </div>
                </div>
            </div>
        </div>

        <div class="row" id="packages">
            <div class="col-12">
                <div class="stat-card">
                    <h5 class="fw-bold mb-4">Service Packages (Uncapped)</h5>
                    <div id="bundle-list" class="row g-3">
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const API_BASE = "https://api.oxeansa.co.za/asherlink/admin";
    const HOTSPOT_API = "https://api.oxeansa.co.za/asherlink/hotspot";
    const SYSTEM_API = "https://api.oxeansa.co.za/asherlink/system";
    const DEFAULT_CPM = 5.00;
    let adminToken = sessionStorage.getItem('adminToken');
    let performanceChart, revenueChart, packageChart;

    if (adminToken) showDashboard();

    async function attemptLogin() {
        const password = document.getElementById('admin_password').value;
        try {
            const res = await fetch(`${API_BASE}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: password })
            });
            const data = await res.json();
            if (res.ok && data.token) {
                sessionStorage.setItem('adminToken', data.token);
                adminToken = data.token;
                showDashboard();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        } catch (err) {
            alert("Core API Connectivity Error");
            console.error(err);
        }
    }

    function showDashboard() {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('dashboard-content').style.display = 'block';
        loadDashboard();
    }

    function logout() {
        sessionStorage.clear();
        location.reload();
    }

    async function loadDashboard() {
        try {
            // Load ads data
            const adsRes = await fetch(`${SYSTEM_API}/ads/active`, {
                headers: { 'X-Admin-Token': adminToken }
            });
            if (adsRes.status === 401) throw new Error('Unauthorized');
            const ads = await adsRes.json();

            // Load bundles data
            const bundlesRes = await fetch(`${HOTSPOT_API}/bundles`);
            const bundles = await bundlesRes.json();

            renderAds(ads);
            renderBundles(bundles);
            updateCharts(ads, bundles);
            calculateGlobalRevenue(ads);
        } catch (err) {
            console.error('Dashboard load error:', err);
            if (err.message === 'Unauthorized') logout();
        }
    }

    function renderAds(ads) {
        const container = document.getElementById('ad-list');
        container.innerHTML = '';
        ads.forEach(ad => {
            const earnings = (ad.impressions / 1000) * (ad.cpm_rate || DEFAULT_CPM);
            const progress = ad.total_limit ? (ad.impressions / ad.total_limit) * 100 : 0;

            container.innerHTML += `
                <div class="col-xl-4 col-md-6">
                    <div class="glass-card h-100 overflow-hidden">
                        <img src="${ad.image_url}" class="ad-img w-100" onerror="this.src='https://placehold.co/600x400/0f172a/FFF?text=Asset+Offline'">
                        <div class="p-4">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="fw-bold mb-0">${ad.ad_id}</h6>
                                    <span class="badge ${ad.active ? 'badge-active' : 'badge-inactive'} mt-1">
                                        ${ad.active ? 'Operational' : 'Paused'}
                                    </span>
                                </div>
                                <h5 class="text-success fw-bold">R ${earnings.toFixed(2)}</h5>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <div class="p-2 bg-light rounded text-center small">
                                        <div class="text-secondary">Views</div>
                                        <div class="fw-bold">${ad.impressions.toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-2 bg-light rounded text-center small">
                                        <div class="text-secondary">Daily</div>
                                        <div class="fw-bold">${ad.daily_count || 0}/${ad.daily_limit || 'âˆž'}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-4">
                                <div class="d-flex justify-content-between small text-secondary mb-1">
                                    <span>Quota Progress</span>
                                    <span>${progress.toFixed(0)}%</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" ${ad.active ? 'checked' : ''} onchange="toggleAd('${ad._id}', this.checked)">
                                    <label class="form-check-label small text-secondary">Active Status</label>
                                </div>
                                <button class="btn btn-sm btn-outline-danger border-0" onclick="deleteAd('${ad._id}')">
                                    <i class="bi bi-trash3"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
        });
    }

    function renderBundles(bundles) {
        const container = document.getElementById('bundle-list');
        container.innerHTML = '';

        bundles.forEach(pkg => {
            container.innerHTML += `
                <div class="col-md-3">
                    <div class="glass-card p-3 border-top border-primary border-4">
                        <h5 class="fw-bold mb-1">${pkg.activePeriod}</h5>
                        <div class="text-primary fw-bold fs-4">R ${pkg.price.toFixed(2)}</div>
                        <div class="small text-muted mb-3">
                            Speed: ${pkg.bandwidth} <br>
                            Quota: ${pkg.quota} <br>
                            Voucher: ${pkg.isVoucherAccepted ? 'Yes' : 'No'}
                        </div>
                        <button onclick="deleteBundle('${pkg._id}')" class="btn btn-sm btn-light w-100">
                            <i class="bi bi-trash3 me-1"></i>Remove
                        </button>
                    </div>
                </div>`;
        });
    }

    function updateCharts(ads, bundles) {
        updatePerformanceChart(ads);
        updateRevenueChart(ads);
        updatePackageChart(bundles);
    }

    function updatePerformanceChart(ads) {
        const ctx = document.getElementById('performanceChart').getContext('2d');
        if (performanceChart) performanceChart.destroy();
        performanceChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ads.map(a => a.ad_id),
                datasets: [{
                    label: 'Lifetime Impressions',
                    data: ads.map(a => a.impressions),
                    backgroundColor: '#2563eb',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { grid: { display: false } } }
            }
        });
    }

    function updateRevenueChart(ads) {
        const ctx = document.getElementById('revenueChart').getContext('2d');
        if (revenueChart) revenueChart.destroy();

        const revenueData = ads.map(ad => (ad.impressions / 1000) * (ad.cpm_rate || DEFAULT_CPM));

        revenueChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ads.map(a => a.ad_id),
                datasets: [{
                    data: revenueData,
                    backgroundColor: ['#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    }

    function updatePackageChart(bundles) {
        const ctx = document.getElementById('packageChart').getContext('2d');
        if (packageChart) packageChart.destroy();

        packageChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: bundles.map(b => b.activePeriod),
                datasets: [{
                    label: 'Package Prices',
                    data: bundles.map(b => b.price),
                    backgroundColor: '#10b981',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { grid: { display: false } } }
            }
        });
    }

    function calculateGlobalRevenue(ads) {
        const total = ads.reduce((sum, ad) => sum + ((ad.impressions / 1000) * (ad.cpm_rate || DEFAULT_CPM)), 0);
        document.getElementById('total-revenue').innerText = `R ${total.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
    }

    // --- API Handlers ---
    async function toggleAd(id, status) {
        try {
            await fetch(`${API_BASE}/ads/manage/${id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Admin-Token': adminToken
                },
                body: JSON.stringify({ active: status })
            });
            loadDashboard();
        } catch (err) {
            console.error('Toggle ad error:', err);
            alert('Failed to update ad status');
        }
    }

    async function deleteAd(id) {
        if (!confirm("Confirm removal of this campaign from the core network?")) return;
        try {
            await fetch(`${API_BASE}/ads/manage/${id}`, {
                method: 'DELETE',
                headers: { 'X-Admin-Token': adminToken }
            });
            loadDashboard();
        } catch (err) {
            console.error('Delete ad error:', err);
            alert('Failed to delete ad');
        }
    }

    async function deleteBundle(id) {
        if (!confirm("Delete this package?")) return;
        try {
            await fetch(`${API_BASE}/bundles/${id}`, {
                method: 'DELETE',
                headers: { 'X-Admin-Token': adminToken }
            });
            loadDashboard();
        } catch (err) {
            console.error('Delete bundle error:', err);
            alert('Failed to delete package');
        }
    }

    // --- Form Handlers ---
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData();
        formData.append('ad_id', document.getElementById('new_ad_id').value);
        formData.append('target_url', document.getElementById('new_target_url').value);
        formData.append('total_limit', document.getElementById('new_total_limit').value);
        formData.append('daily_limit', document.getElementById('new_daily_limit').value);
        formData.append('cpm_rate', document.getElementById('new_cpm_rate').value);
        formData.append('file', document.getElementById('new_file').files[0]);

        try {
            const res = await fetch(`${API_BASE}/ads/create`, {
                method: 'POST',
                headers: { 'X-Admin-Token': adminToken },
                body: formData
            });

            if (res.ok) {
                alert("Campaign initialization successful");
                document.getElementById('uploadForm').reset();
                loadDashboard();
            } else {
                const error = await res.json();
                alert(`Error: ${error.message || 'Operation failed'}`);
            }
        } catch (err) {
            console.error('Upload error:', err);
            alert('Upload failed - check network connection');
        }
    });

    document.getElementById('bundleForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const bundleData = {
            activePeriod: document.getElementById('pkg_period').value,
            price: parseFloat(document.getElementById('pkg_price').value),
            bandwidth: document.getElementById('pkg_speed').value,
            quota: document.getElementById('pkg_quota').value,
            isVoucherAccepted: document.getElementById('pkg_voucher').checked
        };

        try {
            const res = await fetch(`${API_BASE}/bundles`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Admin-Token': adminToken
                },
                body: JSON.stringify(bundleData)
            });

            if (res.ok) {
                alert("Package added successfully");
                document.getElementById('bundleForm').reset();
                loadDashboard();
            } else {
                const error = await res.json();
                alert(`Error: ${error.message || 'Failed to add package'}`);
            }
        } catch (err) {
            console.error('Bundle creation error:', err);
            alert('Failed to create package');
        }
    });

    document.getElementById('tokenForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const tokenData = {
            pin: document.getElementById('token_pin').value.trim(),
            amount: parseFloat(document.getElementById('token_amount').value)
        };

        // Validate PIN format
        if (tokenData.pin.length < 3 || tokenData.pin.length > 15) {
            alert('Token PIN must be 3-15 characters long');
            document.getElementById('token_pin').focus();
            return;
        }

        // Validate amount
        if (isNaN(tokenData.amount) || tokenData.amount <= 0) {
            alert('Please enter a valid amount greater than 0');
            document.getElementById('token_amount').focus();
            return;
        }

        // Show loading state
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Creating...';
        submitBtn.disabled = true;

        try {
            const res = await fetch(`${SYSTEM_API}/tokens/create`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Admin-Token': adminToken
                },
                body: JSON.stringify(tokenData)
            });

            if (res.ok) {
                const result = await res.json();
                alert(`Token "${tokenData.pin}" created successfully!\nValue: R${tokenData.amount.toFixed(2)}`);
                document.getElementById('tokenForm').reset();
                loadTokens(); // Refresh token list
            } else {
                const error = await res.json();
                alert(`Error: ${error.message || 'Failed to create token'}`);
            }
        } catch (err) {
            console.error('Token creation error:', err);
            alert('Failed to create token. Please check your connection.');
        } finally {
            // Reset button state
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });

    // --- Utility Functions ---
    async function downloadReport() {
        try {
            const res = await fetch(`${API_BASE}/ads/report`, {
                headers: { 'X-Admin-Token': adminToken }
            });
            if (!res.ok) {
                alert('Failed to generate report');
                return;
            }
            const blob = await res.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AsherLink_Report_${new Date().toISOString().split('T')[0]}.pdf`;
            a.click();
            window.URL.revokeObjectURL(url);
        } catch (err) {
            console.error('Report download error:', err);
            alert('Failed to download report');
        }
    }

    async function checkSystemHealth() {
        try {
            const res = await fetch(`${API_BASE}/health`, {
                headers: { 'X-Admin-Token': adminToken }
            });
            const health = await res.json();
            alert(`System Status: ${health.status}\nUptime: ${health.uptime}\nDatabase: ${health.database}`);
        } catch (err) {
            console.error('Health check error:', err);
            alert('Health check failed');
        }
    }

    async function createBackup() {
        if (!confirm("Create database backup? This may take a few minutes.")) return;
        try {
            const res = await fetch(`${API_BASE}/backup`, {
                method: 'POST',
                headers: { 'X-Admin-Token': adminToken }
            });
            const result = await res.json();
            alert(`Backup ${result.success ? 'completed' : 'failed'}: ${result.message}`);
        } catch (err) {
            console.error('Backup error:', err);
            alert('Backup failed');
        }
    }

    async function loadTokens() {
        const searchTerm = document.getElementById('search_token').value.trim();
        const tokenList = document.getElementById('token-list');

        try {
            // For now, we'll show a placeholder since we don't have a list tokens endpoint
            // In a real implementation, you'd call an API to get tokens
            tokenList.innerHTML = `
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    Token search functionality will be available once the backend API is implemented.
                    <br><small class="text-muted">Created tokens can be redeemed by users through the main application.</small>
                </div>
            `;

            if (searchTerm) {
                tokenList.innerHTML += `
                    <div class="mt-3">
                        <strong>Search Results for "${searchTerm}":</strong>
                        <p class="text-muted mb-0">No tokens found matching your search.</p>
                    </div>
                `;
            }
        } catch (err) {
            console.error('Token load error:', err);
            tokenList.innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Failed to load tokens. Please try again.
                </div>
            `;
        }
    }

    // Initialize dashboard on load
    document.addEventListener('DOMContentLoaded', function() {
        if (adminToken) {
            showDashboard();
        }

        // Add real-time validation for token PIN
        const tokenPinInput = document.getElementById('token_pin');
        if (tokenPinInput) {
            tokenPinInput.addEventListener('input', function(e) {
                const value = e.target.value;
                const isValid = /^[A-Za-z0-9]{3,15}$/.test(value);
                
                if (value.length > 0) {
                    if (isValid) {
                        e.target.classList.remove('is-invalid');
                        e.target.classList.add('is-valid');
                    } else {
                        e.target.classList.remove('is-valid');
                        e.target.classList.add('is-invalid');
                    }
                } else {
                    e.target.classList.remove('is-valid', 'is-invalid');
                }
            });
        }
    });
</script>
</body>
</html>
