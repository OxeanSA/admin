<!DOCTYPE html>
<html lang="en">
<head>
	<title>Oxean SA | The Future</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">

    <style>
        html, body { overflow: hidden; height: 100vh; width: 100vw; font-family: 'Montserrat-Regular', sans-serif; }
		
        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
            align-items: center;
            position: relative;
            z-index: 10;
        }

		.dash-mode-header { background: #ffffff !important; border-bottom: 1px solid #e5e7eb; color: #000 !important; }
        .dash-mode-header span, .dash-mode-header a { color: #000 !important; }

		.dash-content { 
            display: none; 
            width: 100%; 
            padding: 20px 20px; 
            text-align: left; 
            color: #fafafa; 
            height: calc(100vh - 75px); 
            overflow-y: auto;
        }
		
        .dash-content.active { display: block; animation: fadeIn 0.4s ease; }
        
        .dash-title { font-size: 18px; font-family: Montserrat-SemiBold; text-transform: uppercase; border-left: 4px solid #fff; padding-left: 15px; margin-bottom: 25px; }
        .stat-card { border: 1px solid #e5e7eb; padding: 15px; border-radius: 15px; background: #fafafa; transition: 0.3s; margin-bottom: 15px; }
        .stat-label { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: #6b7280; margin-bottom: 5px; }
        .stat-value { font-size: 16px; font-family: Montserrat-SemiBold; color: #000; }

        .tab-content { display: none; width: 100%; max-width: 1100px; text-align: center; }
        .tab-content.active { display: block; }
        
        .meta-title { font-size: 38px !important; font-family: Montserrat-SemiBold; color: #fff; }
        .grid-card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); padding: 25px; border-radius: 20px; }

        .vertical-nav { position: fixed; left: 25px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 30px; z-index: 1000; }
        .v-icon { color: #fff; font-size: 22px; opacity: 0.5; cursor: pointer; transition: 0.3s; }
		.v-icon.active { opacity: 0.8; color: #3b82f6;}

        #login-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); z-index: 9999; display: none; align-items: center; justify-content: center; }
        .admin-input { background: transparent; border-bottom: 1px solid rgba(255,255,255,0.2); color: #fff; width: 100%; padding: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>
	
    <div id="login-overlay">
        <div class="text-center" style="width: 300px;">
            <h2 class="text-white Montserrat-SemiBold m-b-30">ADMIN ACCESS</h2>
            <input type="password" id="admin_password" class="admin-input" placeholder="ENTER ACCESS KEY">
            <button onclick="attemptAdminLogin()" class="flex-c-m size2 s2-txt1 btn-blue p-lr-15 trans-04 rounded-pill w-full">AUTHORIZE</button>
            <p id="login-error" class="text-danger fs-12 m-t-20 dis-none">INVALID ACCESS KEY</p>
        </div>
    </div>

	<div class="simpleslide0">
		<div class="simpleslide100-item bg-img1" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('images/backgrounds/bg04.jpg') no-repeat center center / cover;"></div>
	</div>

    <div class="vertical-nav">
		<i class="zmdi zmdi-home v-icon" onclick="goToDash('overview')" title="Overview"></i>
        <i class="zmdi zmdi-globe v-icon" onclick="goToDash('marketplace')" title="Explore"></i>
		<i class="zmdi zmdi-card v-icon" onclick="goToDash('billing')" title="Billing"></i>
        <i class="zmdi zmdi-chart v-icon" onclick="goToDash('activity')" title="Analytics"></i>
        <i class="zmdi zmdi-settings v-icon" onclick="openAdmin()" title="Admin Login"></i>
    </div>

	<div class="main-container size1 overlay1 p-l-75 p-r-75 p-lr-15-sm">
		<header class="w-full flex-sb-m p-t-20" id="top-header">
			<div class="wrappic1"><a href="#" onclick="goToTab(0)"><span class="lg-txt1" style="font-size: 20px !important;">Oxean SA</span></a></div>
            <nav class="flex-w flex-m">
                <a href="#" onclick="logout()" class="s1-txt1" style="font-size: 12px; opacity: 0.8;">Sign out</a>
            </nav>
		</header>

		<main class="center-content-wrapper">
            <div id="tab-0" class="tab-content active animated fadeIn">
                <h1 class="meta-title p-b-25">Connecting you<br> to the world</h1>
				<p class="meta-desc">For the Youth, by the Youth</p>
            </div>

            <div id="tab-1" class="tab-content animated fadeIn">... Ecosystem ...</div>
            <div id="tab-2" class="tab-content animated fadeIn">... Development ...</div>

            <div id="dash-overview" class="dash-content animated fadeIn">
                <h2 class="dash-title">System Overview</h2>
                
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card"><p class="stat-label">My Wallet</p><p class="stat-value" id="balance-display">R 0.00</p></div>
                        <div class="stat-card"><p class="stat-label">Net Status</p><p class="stat-value text-success" id="status-internet">Active</p></div>
                        <div class="stat-card"><p class="stat-label">Current Plan</p><p class="stat-value" id="current-plan">Loading...</p></div>
                    </div>

                    <div class="col-md-3">
                        <div class="stat-card"><p class="stat-label">ISP Revenue</p><p class="stat-value" id="total-revenue">R 0.00</p></div>
                        <div class="stat-card"><p class="stat-label">Active Nodes</p><p class="stat-value">142</p></div>
                        <div class="stat-card"><p class="stat-label">System Join Date</p><p class="stat-value" id="join-date">--/--/--</p></div>
                    </div>

                    <div class="col-md-6">
                        <div class="grid-card" style="height: 100%;">
                            <h4 class="m-b-15 fs-14">Traffic Analytics</h4>
                            <canvas id="performanceChart" style="height:180px;"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row m-t-20">
                    <div class="col-md-8">
                        <div class="flex-sb-m m-b-20">
                            <h4 class="Montserrat-SemiBold text-white">Ad Campaigns</h4>
                            <button onclick="$('#upload-ad-box').fadeToggle()" class="btn-blue p-lr-15 p-tb-5 rounded-pill fs-12">New Ad</button>
                        </div>
                        <div id="upload-ad-box" class="grid-card m-b-20 dis-none">
                            <input type="text" id="new_ad_id" class="admin-input" placeholder="Campaign Name">
                            <input type="text" id="new_ad_url" class="admin-input" placeholder="Image URL">
                            <button onclick="uploadAd()" class="btn-blue p-lr-20 p-tb-10 rounded-pill w-full">Push Ad</button>
                        </div>
                        <div id="ad-list" class="row"></div>
                    </div>
                    <div class="col-md-4">
                        <h4 class="Montserrat-SemiBold text-white m-b-20">Bundles</h4>
                        <div id="bundle-list"></div>
                    </div>
                </div>
            </div>

            <div id="dash-marketplace" class="dash-content"><div id="marketplace-grid" class="row"></div></div>
            <div id="dash-billing" class="dash-content">...</div>
            <div id="dash-activity" class="dash-content">
                <canvas id="usageChart"></canvas>
            </div>
		</main>

		<footer class="bottom-controls w-full" style="padding-bottom: 50px;">
			<div class="flex-w flex-c-m">
				<div class="nav-btn active m-lr-20" onclick="goToTab(0)">~</div>
				<div class="nav-btn m-lr-20" onclick="goToTab(1)">Ecosystem</div>
				<div class="nav-btn m-lr-20" onclick="goToTab(2)">Development</div>
			</div>
		</footer>
	</div>

	<script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>

    <script>
        // --- NAVIGATION & SCROLL LOGIC ---
        let currentTab = 0;
        const totalTabs = $('.tab-content').length;
        let isTransitioning = false;

        function goToTab(index) {
            $('body').css('background', '#0f172a');
            $('#top-header').removeClass('dash-mode-header');
            $('.v-icon').removeClass('dash-mode-icons active');
            $('.simpleslide0').show();
            $('.bottom-controls').show();
            $('.dash-content').removeClass('active');
            
            currentTab = index;
            $('.tab-content').removeClass('active');
            $(`#tab-${index}`).addClass('active');
            $('.nav-btn').removeClass('active');
            $($('.nav-btn')[index]).addClass('active');
        }

        window.addEventListener('wheel', function(e) {
            if (isTransitioning || $('.dash-content.active').length) return;
            if (e.deltaY > 0 && currentTab < totalTabs - 1) lockAndGo(currentTab + 1);
            else if (e.deltaY < 0 && currentTab > 0) lockAndGo(currentTab - 1);
        });

        function lockAndGo(index) {
            isTransitioning = true;
            goToTab(index);
            setTimeout(() => { isTransitioning = false; }, 800);
        }

        // --- API & DATA LOGIC ---
        const API_BASE = "/api";
        const ADMIN_API = "https://api.oxeansa.co.za/asherlink/admin";
        const SYSTEM_API = "https://api.oxeansa.co.za/asherlink/system";
        const HOTSPOT_API = "https://api.oxeansa.co.za/asherlink/hotspot";
        let adminToken = sessionStorage.getItem('adminToken');
        let performanceChart, usageChart;

        async function apiRequest(endpoint, method = 'GET', body = null) {
            const accessKey = localStorage.getItem('access_key');
            const refreshKey = localStorage.getItem('refresh_key');
            const headers = { 'Content-Type': 'application/json', 'X-Access-Key': accessKey || '', 'X-Refresh-Key': refreshKey || '' };
            const options = { method, headers };
            if (body) options.body = JSON.stringify(body);
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                return await response.json();
            } catch (err) { return null; }
        }

        function goToDash(sectionId) {
            $('body').css('background', '#0f172a');
            $('#top-header').addClass('dash-mode-header');
            $('.v-icon').addClass('dash-mode-icons');
            $('.simpleslide0').hide();
            $('.bottom-controls').hide();
            $('.tab-content').removeClass('active');
            $('.dash-content').removeClass('active');
            $('.v-icon').removeClass('active');

            $(`#dash-${sectionId}`).addClass('active');
            $(`i[onclick="goToDash('${sectionId}')"]`).addClass('active');

            if (sectionId === 'overview') { fetchUserProfile(); loadAdminData(); }
            if (sectionId === 'marketplace') fetchMarketplace();
            if (sectionId === 'activity') fetchUsageData();
        }

        async function fetchUserProfile() {
            const data = await apiRequest('/user/profile');
            if (data) {
                document.getElementById('balance-display').innerText = `R ${parseFloat(data.balance || 0).toFixed(2)}`;
                document.getElementById('status-internet').innerText = data.paid ? 'Active' : 'Suspended';
                document.getElementById('current-plan').innerText = data.internet_plan || 'No Plan';
                if(data.created_at) document.getElementById('join-date').innerText = new Date(data.created_at).toLocaleDateString();
            }
        }

        async function loadAdminData() {
            if (!adminToken) return;
            try {
                const [adsRes, summaryRes, bundlesRes] = await Promise.all([
                    fetch(`${SYSTEM_API}/ads/active`, { headers: { 'X-Admin-Token': adminToken } }),
                    fetch(`${ADMIN_API}/analytics/summary`, { headers: { 'X-Admin-Token': adminToken } }),
                    fetch(`${HOTSPOT_API}/bundles`)
                ]);
                const ads = await adsRes.json();
                const summary = await summaryRes.json();
                const bundles = await bundlesRes.json();

                document.getElementById('total-revenue').innerText = `R ${Number(summary.total_revenue || 0).toLocaleString()}`;
                
                // Render Ad list
                $('#ad-list').html(ads.map(ad => `<div class="col-md-6 m-b-15"><div class="grid-card"><h5 class="fs-12">${ad.ad_id}</h5><p class="fs-10">Impressions: ${ad.impressions}</p></div></div>`).join(''));
                
                // Render Bundles
                $('#bundle-list').html(bundles.map(b => `<div class="p-2 border-b m-b-5 text-xs flex justify-between"><span>${b.activePeriod}</span><strong>R${b.price}</strong></div>`).join(''));

                updatePerformanceChart(ads);
            } catch (err) { console.error(err); }
        }

        function updatePerformanceChart(ads) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if (performanceChart) performanceChart.destroy();
            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: ads.map(a => a.ad_id), datasets: [{ data: ads.map(a => a.impressions), backgroundColor: '#3b82f6' }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: 'rgba(255,255,255,0.1)' } } } }
            });
        }

        function openAdmin() {
            if (adminToken) goToDash('overview');
            else $('#login-overlay').css('display', 'flex').hide().fadeIn();
        }

        async function attemptAdminLogin() {
            const password = $('#admin_password').val();
            const res = await fetch(`${ADMIN_API}/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password }) });
            const data = await res.json();
            if (res.ok && data.token) {
                sessionStorage.setItem('adminToken', data.token);
                adminToken = data.token;
                $('#login-overlay').hide();
                goToDash('overview');
            } else { $('#login-error').show(); }
        }

        function logout() { sessionStorage.clear(); localStorage.clear(); location.reload(); }
        window.onload = () => { if (localStorage.getItem('access_key')) fetchUserProfile(); };
    </script>
</body>
</html>
