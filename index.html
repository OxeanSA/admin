<!DOCTYPE html>
<html lang="en">
<head>
	<title>Oxean SA | The Future</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">

    <style>
        /* Lock Viewport & Meta Aesthetics */
        html, body { overflow: hidden; height: 100vh; width: 100vw; font-family: 'Montserrat-Regular', sans-serif; }
		
        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
            align-items: center;
            position: relative;
            z-index: 10;
        }

		header { transition: all 0.5s; }

        .center-content-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

		.dash-mode-header { background: #ffffff !important; border-bottom: 1px solid #e5e7eb; color: #000 !important; }
        .dash-mode-header span, .dash-mode-header a { color: #000 !important; }

		.dash-content { 
            display: none; 
            width: 100%; 
            padding: 20px 20px; 
            text-align: left; 
            color: #fafafa; 
            height: calc(100vh - 75px); 
            overflow-y: auto;
        }
		
        .dash-content.active { display: block; animation: fadeIn 0.4s ease; }
        
        .dash-title { font-size: 20px; font-family: Montserrat-SemiBold; letter-spacing: -1px; text-transform: uppercase; border-left: 4px solid #fff; padding-left: 15px; margin-bottom: 30px; }
        .stat-card { border: 1px solid #e5e7eb; padding: 20px; border-radius: 20px; background: #fafafa; transition: 0.3s; }
        .stat-card:hover { border-color: #000; }
        .stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #6b7280; }
        .stat-value { font-size: 18px; font-family: Montserrat-SemiBold; color: #000; }

        .tab-content, .dash-content { display: none; width: 100%; max-width: 1100px; text-align: center; }
        .tab-content.active, .dash-content.active  { display: block; }
        
        .meta-title { font-size: 38px !important; font-family: Montserrat-SemiBold; letter-spacing: -0.5px; line-height: 1.1; color: #fff; }
        .meta-desc { font-size: 14px !important; line-height: 1.6; color: rgba(255,255,255,0.7); max-width: 600px; margin: 0 auto; }
        .small-tag { font-size: 10px; text-transform: uppercase; letter-spacing: 2.5px; color: #0084ff; font-weight: bold; margin-bottom: 15px; display: block; }
        
        .grid-card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); padding: 30px; border-radius: 20px; transition: all 0.3s ease; }

        .vertical-nav {
            position: fixed;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 30px;
            z-index: 1000;
        }
        .v-icon { color: #fff; font-size: 22px; opacity: 0.5; cursor: pointer; transition: 0.3s; }
        .v-icon:hover { opacity: 1; }
		.v-icon.active { opacity: 0.8; color: #3b82f6;}

        /* Admin Specific Styling */
        #login-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px);
            z-index: 9999; display: none; align-items: center; justify-content: center;
        }
        .admin-input { background: transparent; border-bottom: 1px solid rgba(255,255,255,0.2); color: #fff; width: 100%; padding: 10px; margin-bottom: 15px; font-family: Montserrat-Regular; }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .badge-active { background: #10b981; color: #fff; }
        .badge-inactive { background: #ef4444; color: #fff; }

        @media (max-width: 767px) {
            .vertical-nav { left: 15px; }
			.dash-content { padding: 20px 14px 20px 45px; }
            .meta-title { font-size: 26px !important; }
        }
    </style>
</head>
<body>
	
    <div id="login-overlay">
        <div class="text-center" style="width: 300px;">
            <span class="small-tag">Secure Access</span>
            <h2 class="text-white Montserrat-SemiBold m-b-30">ADMIN TERMINAL</h2>
            <input type="password" id="admin_password" class="admin-input" placeholder="ACCESS KEY">
            <button onclick="attemptLogin()" class="flex-c-m size2 s2-txt1 btn-blue p-lr-15 trans-04 rounded-pill w-full">AUTHORIZE</button>
            <p id="login-error" class="text-danger fs-12 m-t-20 dis-none">INVALID ACCESS KEY</p>
        </div>
    </div>

	<div class="simpleslide0">
		<div class="simpleslide100-item bg-img1" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('images/backgrounds/bg04.jpg') no-repeat center center / cover;"></div>
	</div>

    <div class="vertical-nav">
		<i class="zmdi zmdi-home v-icon active" onclick="goToTab(0)" title="Home"></i>
        <i class="zmdi zmdi-globe v-icon" onclick="goToDash('marketplace')" title="Exlore"></i>
		<i class="zmdi zmdi-card v-icon" onclick="goToDash('billing')" title="Billing"></i>
        <i class="zmdi zmdi-chart v-icon" onclick="goToDash('activity')" title="Analytics"></i>
        <i class="zmdi zmdi-settings v-icon" onclick="openAdmin()" title="Admin Panel"></i>
    </div>

	<div class="main-container size1 overlay1 p-l-75 p-r-75 p-lr-15-sm">
		<header class="w-full flex-sb-m p-t-20" id="top-header">
			<div class="wrappic1"><a href="#"><span class="lg-txt1" style="font-size: 20px !important;">Oxean SA</span></a></div>
            <nav class="flex-w flex-m">
                <a href="#" onclick="logout()" class="s1-txt1" style="font-size: 12px; opacity: 0.8;">Sign out</a>
            </nav>
		</header>

		<main class="center-content-wrapper">
            <div id="tab-0" class="tab-content active animated fadeIn">
                <h1 class="meta-title p-b-25">Connecting you<br> to the world</h1>
				<p class="meta-desc">For the Youth, by the Youth</p>
            </div>

            <div id="dash-admin" class="dash-content animated fadeIn">
                <h2 class="dash-title">ISP Administration</h2>
                
                <div class="row m-b-30">
                    <div class="col-md-3"><div class="stat-card"><p class="stat-label">Total Revenue</p><p class="stat-value" id="total-revenue">R 0.00</p></div></div>
                    <div class="col-md-9">
                        <div class="grid-card" style="padding: 20px;">
                            <canvas id="performanceChart" style="height:120px;"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="flex-sb-m m-b-20">
                            <h4 class="Montserrat-SemiBold text-white">Ad Campaigns</h4>
                            <button onclick="$('#upload-ad-modal').fadeToggle()" class="btn-blue p-lr-15 p-tb-5 rounded-pill fs-12">New Campaign</button>
                        </div>
                        
                        <div id="upload-ad-modal" class="grid-card m-b-20 dis-none">
                            <h5 class="m-b-15 fs-14">Upload New Advertisement</h5>
                            <div class="row">
                                <div class="col-md-6"><input type="text" id="new_ad_id" class="admin-input" placeholder="Campaign Name"></div>
                                <div class="col-md-6"><input type="text" id="new_ad_url" class="admin-input" placeholder="Image URL"></div>
                            </div>
                            <button onclick="uploadAd()" class="btn-blue p-lr-20 p-tb-10 rounded-pill w-full m-t-10">Sync to System</button>
                        </div>

                        <div id="ad-list" class="row"></div>
                    </div>

                    <div class="col-md-4">
                        <h4 class="Montserrat-SemiBold text-white m-b-20">Hotspot Bundles</h4>
                        <div id="bundle-list" class="row"></div>
                    </div>
                </div>
            </div>
		</main>
	</div>

	<script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>

    <script>
        // --- CORE API CONSTANTS ---
        const API_BASE = "https://api.oxeansa.co.za/asherlink/admin";
        const SYSTEM_API = "https://api.oxeansa.co.za/asherlink/system";
        const HOTSPOT_API = "https://api.oxeansa.co.za/asherlink/hotspot";
        const DEFAULT_CPM = 5.00;
        let adminToken = sessionStorage.getItem('adminToken');
        let performanceChart;

        // AUTHENTICATION
        async function attemptLogin() {
            const password = document.getElementById('admin_password').value;
            try {
                const res = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                const data = await res.json();
                if (res.ok && data.token) {
                    sessionStorage.setItem('adminToken', data.token);
                    adminToken = data.token;
                    showDashboard();
                } else {
                    document.getElementById('login-error').classList.remove('dis-none');
                }
            } catch (err) { alert("Core API Offline"); }
        }

        function showDashboard() {
            document.getElementById('login-overlay').style.display = 'none';
            goToDash('admin');
            loadDashboard();
        }

        // DATA SYNC
        async function loadDashboard() {
            try {
                const [adsRes, summaryRes, bundlesRes] = await Promise.all([
                    fetch(`${SYSTEM_API}/ads/active`, { headers: { 'X-Admin-Token': adminToken } }),
                    fetch(`${API_BASE}/analytics/summary`, { headers: { 'X-Admin-Token': adminToken } }),
                    fetch(`${HOTSPOT_API}/bundles`)
                ]);

                const ads = await adsRes.json();
                const summary = await summaryRes.json();
                const bundles = await bundlesRes.json();

                document.getElementById('total-revenue').innerText = `R ${Number(summary.total_revenue || 0).toLocaleString()}`;
                
                renderAds(ads);
                renderBundles(bundles);
                updateCharts(ads);
            } catch (err) { console.error(err); }
        }

        function renderAds(ads) {
            const container = document.getElementById('ad-list');
            container.innerHTML = ads.map(ad => `
                <div class="col-md-6 m-b-20">
                    <div class="grid-card">
                        <img src="${ad.image_url}" class="w-full rounded m-b-15" style="height:100px; object-fit:cover;">
                        <h5 class="fs-13 Montserrat-SemiBold">${ad.ad_id}</h5>
                        <div class="flex-sb-m m-t-10">
                            <span class="status-badge ${ad.active ? 'badge-active' : 'badge-inactive'}">${ad.active ? 'Live' : 'Paused'}</span>
                            <span class="text-white fs-12">R ${((ad.impressions/1000)*DEFAULT_CPM).toFixed(2)} Earned</span>
                        </div>
                        <button onclick="deleteAd('${ad._id}')" class="text-danger fs-11 m-t-10">Remove Campaign</button>
                    </div>
                </div>
            `).join('');
        }

        function renderBundles(bundles) {
            const container = document.getElementById('bundle-list');
            container.innerHTML = bundles.map(b => `
                <div class="col-12 m-b-10">
                    <div class="p-all-15 rounded" style="background:rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">
                        <div class="flex-sb-m">
                            <div>
                                <p class="fs-13 Montserrat-SemiBold m-b-0 text-white">${b.activePeriod}</p>
                                <small class="text-muted">${b.bandwidth} | ${b.quota}</small>
                            </div>
                            <p class="text-primary Montserrat-SemiBold">R${b.price}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function uploadAd() {
            const ad_id = $('#new_ad_id').val();
            const image_url = $('#new_ad_url').val();
            const res = await fetch(`${SYSTEM_API}/ads/upload`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-Admin-Token': adminToken },
                body: JSON.stringify({ ad_id, image_url })
            });
            if (res.ok) {
                $('#upload-ad-modal').hide();
                loadDashboard();
            }
        }

        function updateCharts(ads) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if (performanceChart) performanceChart.destroy();
            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ads.map(a => a.ad_id),
                    datasets: [{ label: 'Impressions', data: ads.map(a => a.impressions), backgroundColor: '#3b82f6' }]
                },
                options: { 
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }, 
                    scales: { y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } } 
                }
            });
        }

        // --- NAVIGATION & HELPERS ---
        function openAdmin() {
            if (adminToken) showDashboard();
            else $('#login-overlay').css('display', 'flex').hide().fadeIn();
        }

        function goToDash(sectionId) {
            $('body').css('background', '#0f172a');
            $('#top-header').addClass('dash-mode-header');
            $('.simpleslide0').hide();
            $('.tab-content, .dash-content').removeClass('active');
            $(`#dash-${sectionId}`).addClass('active');
        }

        function goToTab(index) {
            $('body').css('background', '');
            $('#top-header').removeClass('dash-mode-header');
            $('.simpleslide0').show();
            $('.tab-content, .dash-content').removeClass('active');
            $(`#tab-${index}`).addClass('active');
        }

        function logout() { sessionStorage.clear(); location.reload(); }
        window.onload = () => { if (adminToken) showDashboard(); };
    </script>
</body>
</html>
